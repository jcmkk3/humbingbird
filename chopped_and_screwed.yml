units:
  cx: 18.5     # Key spacing horizontal
  cy: 17.5     # Key spacing vertical
  sc: 14       # Switch cutout (square)
  sf: 16       # Switch footprint (square)
  bx: cx - sf  # Bind padding horizontal
  by: cy - sf  # Bind padding vertical
  angle: 23    # Angle between halves
  xiaox: 17.5
  xiaoy: 20
points:
  rotate: -angle + 5
  mirror:
    ref: matrix_inner_top
    distance: 15.5 + cx + 1
  zones.matrix:
    rows:
      bottom.padding: cy
      home.padding: cy
      top.padding: cy
    columns.pinky:
      spread: cx
      rows:
        bottom.skip: true
        top:
          bind: [0,bx + 3,by,0]
          row_net: P0
          column_net: P6
        home:
          bind: [by,bx + 3,0,0]
          row_net: P2
          column_net: P6
        top.mirror:
          row_net: P1
          column_net: P10
        home.mirror:
          row_net: P3
          column_net: P10
    columns.ring:
      spread: cx -0.3
      stagger: 0.55cy
      rotate: -3
      rows:
        top:
          bind: [0,bx + 3,by,0]
          row_net: P1
          column_net: P6
        home:
          bind: [0,bx + 3,0,0]
          row_net: P3
          column_net: P6
        bottom:
          bind: [by,0,0,0]
          row_net: P4
          column_net: P6
        top.mirror:
          row_net: P0
          column_net: P10
        home.mirror:
          row_net: P2
          column_net: P10
        bottom.mirror:
          row_net: P5
          column_net: P9
    columns.middle:
      spread: cx
      stagger: 0.35cy
      rotate: -2
      rows:
        top:
          bind: [0,0,by,0]
          row_net: P0
          column_net: P7
        home:
          bind: [0,bx,0,0]
          row_net: P2
          column_net: P7
        bottom:
          bind: [by,bx,0,bx + 3]
          row_net: P5
          column_net: P6
        top.mirror:
          row_net: P1
          column_net: P9
        home.mirror:
          row_net: P3
          column_net: P9
        bottom.mirror:
          row_net: P4
          column_net: P9
    columns.index:
      spread: cx
      stagger: -0.35cy
      rows:
        top:
          bind: [0,0,by,bx]
          row_net: P1
          column_net: P7
        home:
          row_net: P3
          column_net: P7
        bottom:
          bind: [by,0,0,0]
          row_net: P4
          column_net: P7
        top.mirror:
          row_net: P0
          column_net: P9
        home.mirror:
          row_net: P2
          column_net: P9
        bottom.mirror:
          row_net: P5
          column_net: P8
    columns.inner:
      spread: cx
      stagger: -0.5cy
      rows:
        bottom.skip: true
        top:
          bind: [0,0,by,bx]
          row_net: P0
          column_net: P8
        home:
          bind: [by,0,by,bx]
          row_net: P2
          column_net: P8
        top.mirror:
          row_net: P1
          column_net: P8
        home.mirror:
          row_net: P3
          column_net: P8
  zones.thumb:
    anchor:
      ref: matrix_index_bottom
      shift: [0.35cx, -22]
    rows.thumb:
    columns.outer:
      rows:
        thumb:
          bind: [cy, bx, 0, 0]
          row_net: P5
          column_net: P7
        thumb.mirror:
          row_net: P4
          column_net: P10
    columns.inner:
      spread: cx
      stagger: -0.25cy
      rows:
        thumb:
          bind: [1.5cy, 0, 0, 0]
          row_net: P4
          column_net: P8
        thumb.mirror:
          row_net: P5
          column_net: P10
  key:
    footprints:
      choc:
        type: choc
        nets:
          from: =row_net
          to: =colrow
        params:
          keycaps: true
      diode:
        type: diode
        anchor:
          shift: [0, -4.7]
        nets:
          from: =column_net
          to: =colrow
        params:
          through_hole: false
outlines:
  exports:
    _center:
      - type: polygon
        points:
          - ref: matrix_inner_top
            shift: [0,-0.7cy]
          - ref: mirror_matrix_inner_top
            shift: [0,-0.7cy]
          - ref: mirror_thumb_inner_thumb
          - ref: thumb_inner_thumb
    _top_center:
      - type: keys
        side: left
        size: sf
      - type: keys
        side: right
        size: sf
      - type: outline
        name: _center
      - operation: intersect
        type: polygon
        points:
          - ref: matrix_inner_top
            shift: [-cx, 0]
          - ref: mirror_matrix_inner_top
            shift: [-cx, 0]
          - ref: mirror_matrix_inner_home
          - ref: matrix_inner_home
    _bottom_center:
      - type: outline
        name: _center
      - operation: subtract
        type: circle
        anchor:
          ref: [thumb_inner_thumb, mirror_thumb_inner_thumb]
          shift: [0, -60 + 0.5cy]
        radius: 60
    _combined:
      - type: outline
        name: _top_center
        fillet: 3
      - type: outline
        name: _bottom_center
      - type: keys
        side: left
        size: sf
      - type: keys
        side: right
        size: sf
    switch_cutouts:
      - type: keys
        side: left
        size: sc
        bound: false
      - type: keys
        side: right
        size: sc
        bound: false
    panel:
      - type: outline
        name: _combined
        fillet: 1
    switch_plate:
      main:
        type: outline
        name: _combined
        fillet: 1
      keyholes:
        type: outline
        name: switch_cutouts
        operation: subtract
        fillet: 0.5
pcbs:
  humbingbird:
    outlines:
      main:
        outline: panel
    footprints:
      - type: xiao
        anchor:
          ref: [matrix_inner_top, mirror_matrix_inner_top]
          shift: [-(xiaox / 2), -0.7cy - xiaoy]
